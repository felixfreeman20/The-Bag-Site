<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE BAG | HQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: sans-serif; }
        .card-bg { background: #0f172a; border: 1px solid #1e293b; border-radius: 2rem; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .stock-row { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(59, 130, 246, 0.1); }
        .stock-row:hover { border-color: rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body class="p-6">
    <header class="flex justify-between items-center mb-10 pb-6 border-b border-slate-800">
        <h1 class="text-3xl font-black italic text-blue-500 uppercase">Bag HQ</h1>
        <div class="flex gap-4">
            <button onclick="toggleStore()" id="store-btn" class="px-8 py-3 rounded-2xl font-black text-xs uppercase transition-all">Syncing...</button>
            <button onclick="toggleFlash()" id="flash-btn" class="bg-red-600 px-8 py-3 rounded-2xl font-black text-xs uppercase">Flash Sale</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2"><div id="order-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div></div>
        
        <div class="card-bg p-8 h-fit shadow-2xl sticky top-6">
            <h2 class="text-xs font-black uppercase text-blue-400 mb-6 tracking-widest">Inventory Levels</h2>
            <div id="stock-list" class="space-y-3 mb-8"></div>
            <button onclick="saveAllStock()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-5 rounded-2xl font-black uppercase text-xs transition-all shadow-xl shadow-blue-900/40">
                Update Stock Levels
            </button>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAFGoJyyvtspQSauHUrWvSBWNF2taGJOYE", databaseURL: "https://thebagsite-default-rtdb.asia-southeast1.firebasedatabase.app/", projectId: "thebagsite" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();

        let localStock = {};
        const snacks = ["squid_l_red", "squid_l_orange", "squid_g", "squid_o", "squid_r", "doritos", "pocky", "oreo", "lays_s", "lays_n", "gummy", "gum"];

        db.ref('settings/storeOpen').on('value', snap => {
            const open = snap.val();
            const btn = document.getElementById('store-btn');
            btn.innerText = open ? "Store: Open" : "Store: Closed";
            btn.className = open ? "bg-green-600 px-8 py-3 rounded-2xl font-black text-xs uppercase" : "bg-red-600 px-8 py-3 rounded-2xl font-black text-xs uppercase";
        });

        function toggleStore() { db.ref('settings/storeOpen').once('value', snap => db.ref('settings/storeOpen').set(!snap.val())); }

        db.ref('stock').on('value', snap => { localStock = snap.val() || {}; renderStock(); });

        function renderStock() {
            const container = document.getElementById('stock-list');
            container.innerHTML = "";
            snacks.forEach(id => {
                const val = localStock[id] || 0;
                container.innerHTML += `
                <div class="flex items-center justify-between p-4 rounded-2xl stock-row transition-all">
                    <span class="text-[10px] font-black uppercase text-slate-300">${id.replace(/_/g, ' ')}</span>
                    <div class="flex items-center gap-2">
                        <button onclick="adj('${id}', -1)" class="w-9 h-9 bg-slate-800 hover:bg-slate-700 rounded-xl font-bold border border-slate-700">-</button>
                        <input type="number" value="${val}" class="w-12 bg-transparent text-center font-black text-blue-500 outline-none text-sm" onchange="localStock['${id}']=parseInt(this.value)">
                        <button onclick="adj('${id}', 1)" class="w-9 h-9 bg-slate-800 hover:bg-slate-700 rounded-xl font-bold border border-slate-700">+</button>
                    </div>
                </div>`;
            });
        }
        function adj(id, a) { localStock[id] = Math.max(0, (localStock[id] || 0) + a); renderStock(); }
        function saveAllStock() { db.ref('stock').set(localStock).then(() => alert("Inventory Updated! ✅")); }

        db.ref('orders').on('value', snap => {
            const list = document.getElementById('order-list'); list.innerHTML = "";
            const data = snap.val() || {};
            Object.keys(data).reverse().forEach(id => {
                const o = data[id]; if(o.status === 'completed' || o.status === 'cancelled') return;
                list.innerHTML += `<div class="card-bg p-6 border-l-4 ${o.status === 'pending' ? 'border-yellow-500' : 'border-blue-500'}">
                    <div class="flex justify-between font-black uppercase text-sm mb-2"><span>${o.name}</span><span class="text-blue-500">${o.total}฿</span></div>
                    <p class="text-slate-400 text-xs mb-6 font-medium italic">${o.items}</p>
                    <div class="flex gap-2">
                        ${o.status === 'pending' ? `<button onclick="upd('${id}', 'active')" class="bg-blue-600 flex-1 py-3 rounded-xl font-black text-[10px] uppercase">Accept</button><button onclick="upd('${id}', 'cancelled')" class="bg-red-600 text-white px-4 rounded-xl font-black text-[10px] uppercase">Decline</button>` : `<button onclick="upd('${id}', 'completed')" class="bg-green-600 flex-1 py-3 rounded-xl font-black text-[10px] uppercase">Complete</button>`}
                    </div>
                </div>`;
            });
        });
        function upd(id, s) { db.ref('orders/' + id).update({ status: s }); }
        function toggleFlash() { db.ref('settings/flashSale').once('value', snap => { const active = snap.val()?.active; db.ref('settings/flashSale').set({ active: !active, end: !active ? Date.now() + 600000 : 0 }); }); }
    </script>
</body>
</html>
