<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE BAG | HQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: sans-serif; }
        .order-card { background: #0f172a; border: 1px solid #1e293b; border-radius: 1.5rem; transition: transform 0.2s; }
        .order-card:hover { transform: translateY(-2px); }
        .pending-glow { border-color: #f59e0b; box-shadow: 0 0 15px rgba(245, 158, 11, 0.1); }
    </style>
</head>
<body class="p-6 lg:p-10">
    <audio id="pop-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>
    
    <header class="flex justify-between items-center mb-12 border-b border-slate-800 pb-8">
        <div class="flex items-center gap-4">
            <img src="logo.png" class="h-12 w-12 object-contain">
            <div>
                <h1 class="text-3xl font-black italic text-blue-500 uppercase tracking-tighter">Command Center</h1>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">Live Operations</p>
            </div>
        </div>
        <div class="flex gap-4">
             <button onclick="toggleStore()" id="store-btn" class="bg-green-600 px-8 py-3 rounded-2xl font-black text-xs uppercase">Store: Open</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
            <h2 class="text-sm font-black uppercase text-slate-500 mb-6 flex items-center gap-2">
                <span class="w-2 h-2 bg-blue-500 rounded-full animate-ping"></span> 
                Incoming & Active Orders
            </h2>
            <div id="order-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <div class="bg-slate-900/50 p-6 rounded-[2.5rem] border border-slate-800 h-fit">
            <h2 class="text-sm font-black uppercase text-slate-500 mb-6">Stock Control</h2>
            <div id="stock-list" class="space-y-3"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAFGoJyyvtspQSauHUrWvSBWNF2taGJOYE", databaseURL: "https://thebagsite-default-rtdb.asia-southeast1.firebasedatabase.app/", projectId: "thebagsite" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();

        function playPop() { document.getElementById('pop-sound').play(); }

        // ORDERS LIST
        db.ref('orders').on('value', snap => {
            const list = document.getElementById('order-list'); list.innerHTML = "";
            const data = snap.val() || {};
            Object.keys(data).reverse().forEach(id => {
                const o = data[id];
                if(o.status === 'completed' || o.status === 'cancelled') return;

                list.innerHTML += `
                <div class="order-card p-6 ${o.status === 'pending' ? 'pending-glow' : ''}">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-black text-lg uppercase tracking-tight">${o.name}</h3>
                            <span class="bg-blue-500/10 text-blue-400 text-[10px] font-black px-2 py-1 rounded-md uppercase">Grade ${o.grade}</span>
                        </div>
                        <span class="text-blue-500 font-black text-xl">${o.total}à¸¿</span>
                    </div>
                    <p class="text-slate-400 text-sm font-medium leading-relaxed mb-6">${o.items}</p>
                    <div class="flex gap-2">
                        ${o.status === 'pending' ? `
                            <button onclick="upd('${id}', 'active')" class="bg-blue-600 hover:bg-blue-500 flex-1 py-3 rounded-xl font-black text-[10px] uppercase transition-colors">Accept</button>
                            <button onclick="upd('${id}', 'cancelled')" class="bg-red-600/20 text-red-500 hover:bg-red-600/30 w-1/3 py-3 rounded-xl font-black text-[10px] uppercase transition-colors">Decline</button>
                        ` : `
                            <button onclick="upd('${id}', 'completed')" class="bg-green-600 hover:bg-green-500 flex-1 py-3 rounded-xl font-black text-[10px] uppercase transition-colors">Mark Complete</button>
                        `}
                    </div>
                </div>`;
            });
        });

        // INVENTORY LIST
        const snacks = ["squid_l_red", "squid_l_orange", "squid_g", "squid_o", "squid_r", "doritos", "pocky", "oreo", "lays_s", "lays_n", "gummy", "gum"];
        db.ref('stock').on('value', snap => {
            const sList = document.getElementById('stock-list'); sList.innerHTML = "";
            const stock = snap.val() || {};
            snacks.forEach(id => {
                sList.innerHTML += `
                <div class="flex items-center justify-between bg-slate-800/40 p-4 rounded-2xl border border-slate-800/50">
                    <span class="text-[10px] font-black uppercase text-slate-300">${id.replace(/_/g, ' ')}</span>
                    <div class="flex items-center gap-3">
                        <button onclick="changeStock('${id}', -1)" class="bg-slate-700 hover:bg-slate-600 w-8 h-8 rounded-lg flex items-center justify-center font-bold">-</button>
                        <span class="font-black text-blue-500 w-4 text-center">${stock[id]||0}</span>
                        <button onclick="changeStock('${id}', 1)" class="bg-slate-700 hover:bg-slate-600 w-8 h-8 rounded-lg flex items-center justify-center font-bold">+</button>
                    </div>
                </div>`;
            });
        });

        function upd(id, s) { playPop(); db.ref('orders/' + id).update({ status: s }); }
        function changeStock(id, amt) { playPop(); db.ref('stock/'+id).transaction(c => (c||0) + amt); }
    </script>
</body>
</html>
