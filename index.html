<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE BAG | Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; }
        .item-card { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; border-radius: 1.5rem; overflow: hidden; }
        .out-of-stock { opacity: 0.4; filter: grayscale(1); pointer-events: none; }
        .badge-sold-out { background: #ef4444; color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; position: absolute; top: 10px; right: 10px; z-index: 10; }
    </style>
</head>
<body class="p-4 pb-32">

    <header class="max-w-md mx-auto mb-8 pt-4">
        <h1 class="text-3xl font-black italic uppercase text-blue-500">The Bag.</h1>
        <p id="store-status" class="text-[10px] font-bold uppercase tracking-widest opacity-60">Checking Store Status...</p>
    </header>

    <div id="shop-container" class="max-w-md mx-auto grid grid-cols-2 gap-4">
        </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-slate-900/80 backdrop-blur-lg border-t border-slate-800 flex justify-between items-center z-50">
        <div>
            <p class="text-[10px] font-black uppercase opacity-50">Total Amount</p>
            <p id="cart-total" class="text-xl font-black text-green-500">$0.00</p>
        </div>
        <button onclick="alert('Proceeding to Checkout...')" class="bg-blue-600 px-8 py-4 rounded-2xl font-black uppercase text-sm shadow-lg shadow-blue-900/40">Checkout</button>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAFGoJyyvtspQSauHUrWvSBWNF2taGJOYE", 
            databaseURL: "https://thebagsite-default-rtdb.asia-southeast1.firebasedatabase.app/", 
            projectId: "thebagsite" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Catalog setup
        const catalog = [
            { id: 'squid_r', name: 'Squid Red', price: 1.50 },
            { id: 'squid_o', name: 'Squid Orange', price: 1.50 },
            { id: 'squid_g', name: 'Squid Green', price: 1.50 },
            { id: 'squid_l_red', name: 'Squid L Red', price: 2.50 },
            { id: 'squid_l_orange', name: 'Squid L Orange', price: 2.50 },
            { id: 'doritos', name: 'Doritos', price: 2.00 },
            { id: 'pocky', name: 'Pocky', price: 2.00 },
            { id: 'oreo', name: 'Oreo', price: 1.50 },
            { id: 'lays_s', name: 'Lays Salt', price: 2.00 },
            { id: 'lays_n', name: 'Lays Nori', price: 2.00 },
            { id: 'gummy', name: 'Gummy Bears', price: 1.00 },
            { id: 'gum', name: 'Chewing Gum', price: 0.50 }
        ];

        // Global store state
        let currentStock = {};

        // Listen for Stock Updates
        db.ref('stock').on('value', snap => {
            currentStock = snap.val() || {};
            renderShop(); // Refresh UI whenever stock changes in database
        });

        // Listen for Store Open/Closed
        db.ref('settings/storeOpen').on('value', snap => {
            const isOpen = snap.val();
            document.getElementById('store-status').innerText = isOpen ? "‚óè Store is Open" : "‚óã Store is Closed";
            document.getElementById('store-status').className = isOpen ? "text-[10px] font-bold uppercase tracking-widest text-green-500" : "text-[10px] font-bold uppercase tracking-widest text-red-500";
        });

        function renderShop() {
            const container = document.getElementById('shop-container');
            container.innerHTML = "";

            catalog.forEach(item => {
                const stockCount = currentStock[item.id] || 0;
                const isAvailable = stockCount > 0;
                
                container.innerHTML += `
                    <div class="item-card p-4 relative ${!isAvailable ? 'out-of-stock' : ''}">
                        ${!isAvailable ? '<div class="badge-sold-out">Sold Out</div>' : ''}
                        <div class="w-full h-32 bg-slate-800 rounded-xl mb-3 flex items-center justify-center text-4xl">
                            ${isAvailable ? 'üì¶' : '‚ùå'}
                        </div>
                        <h3 class="font-black uppercase text-xs mb-1">${item.name.replace(/_/g, ' ')}</h3>
                        <div class="flex justify-between items-center">
                            <p class="text-blue-400 font-black">$${item.price.toFixed(2)}</p>
                            <p class="text-[10px] font-bold opacity-50">${stockCount} Left</p>
                        </div>
                        <button 
                            onclick="addToCart('${item.id}')" 
                            class="w-full mt-3 py-2 bg-slate-700 hover:bg-blue-600 rounded-lg font-black text-[10px] uppercase transition-all"
                            ${!isAvailable ? 'disabled' : ''}>
                            Add to Bag
                        </button>
                    </div>
                `;
            });
        }

        function addToCart(id) {
            console.log("Added to cart:", id);
            // Add your cart logic here
        }

        renderShop();
    </script>
</body>
</html>
